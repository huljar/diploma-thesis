After the protocol design phase (Chapter \ref{ch:protocol}) and the implementation with the simulator (Chapter \ref{ch:implementation}), the next step
is to evaluate the different approaches. As the primary goal of this thesis is to provide protection and resilience against malicious routers within
the \gls{noc}, the protocol variants were tested for varying attacker positions, attack probabilities, and routing strategies. The quality of a scheme
is determined through several metrics that indicate its performance for a given scenario, which are explained below.

The next section establishes notations and key terms that are used throughout this chapter. Afterwards, the environment and frame conditions for the
simulations are delineated (Section \ref{sec:environmenteval}). Following this, the employed attacker model is discussed (Section
\ref{sec:attackermodeleval}). Subsequently, the hyperparameters are fixed through a series of representative experiments (Section
\ref{sec:hyperparamseval}), followed by the main evaluation where the different protocol variants and routing strategies are compared (Section
\ref{sec:perfcompeval}).

\section{Notation}\label{sec:notationeval}
To improve readability, abbreviations are introduced for the protocol variants and network coding modes. This facilitates their representation within
charts, diagrams, and tables.
\begin{itemize}
    \item \textbf{\Gls{ida}} stands for the \textit{individual authentication} protocol version
    \item \textbf{\Gls{iwa}} represents the \textit{interwoven authentication} approach
    \item \textbf{\Gls{fga}} denotes the \textit{full-generation authentication} variant
    \item \textbf{UC} is short for \textit{uncoded}, i.e., the lack of network coding
    \item \textbf{G2C3} and \textbf{G2C4} are used for the two network coding variants that were explained in Section \ref{sec:designnc}.
\end{itemize}
\vspace{0.5\baselineskip}

These terms are often combined with a routing strategy when the setup of an experiment is described. For instance, \gls{ida}-UC-\gls{dor} stands for uncoded
individual authentication using dimension order routing.

%Terms "source flit", router "port queues", "local queues", "creation rate"

\section{Environment}\label{sec:environmenteval}
In this section, the general setup for all conducted simulations is elaborated, such as flit generation patterns and simulation runtime. Table
\vref{tab:fixedparams} provides a concise overview of these invariant parameters and their values.

\begin{table}
    \centering
    \begin{tabulary}{\textwidth}{L|L}
        Parameter name & Value \\\hline
        \Gls{noc} dimensions & 8x8 \\
        Clock frequency & 500 MHz \\
        Simulation runtime & \num{50000} cycles \\
        Warmup/cooldown time & 500 cycles \\
        Network base injection rate & 0.2 \\
        Flit destination selection & uniform random \\
        Pair generation & yes \\
    \end{tabulary}
    \caption[short]{long}
    \label{tab:fixedparams}
\end{table}

When a simulation is executed, the first 500 cycles are considered warmup time. During this period, no statistics are recorded. This ensures that the
network is in a steady state and already saturated with flits once the recording starts. It is followed by the main simulation of \num{50000}
cycles where statistics are recorded normally. Finally, there is another 500 cooldown cycles at the end. This was added to ensure that those flits
generated near the end of the main simulation are not classified as lost flits simply because they were not granted enough time to reach their
destination. Thus, flits arriving at processing elements during the cooldown period are considered successfully transmitted, while flits generated
during this period are not included in the statistics.

The network base injection rate describes the average number of flits injected into the network per clock cycle at each node, excluding \gls{arq}
flits and retransmissions. The creation rate of flits at the processing elements is adjusted accordingly for each protocol variant to keep the
injection rate constant. For instance, with \gls{ida}-G2C3, every flit created at a particular processing element results in three flits injected
into the network due to network coding and the additional \gls{mac} flits. Hence, the creation rate would be $\frac{0.2}{3}$ for this scenario.

The processing elements create flits independently from each other. All processing elements use the same creation rate. The selection of the flits'
destinations is performed randomly with a uniform probability distibution over all network nodes (excluding the sender's own node).

To allow for a fair comparison of the protocol versions, flits are always generated in pairs. This means that when a particular processing
element creates a flit, another one with the same destination is guaranteed to be created on the next clock cycle. This prevents long periods of
buffering for network coded \gls{ida} and \gls{fga} in the sender's network interface: with a pair of flits, a generation can be formed immediately. This creation
pattern is a realistic assumption as in practical applications, flits are usually generated from breaking a data packet down into smaller parts. These
flits would then enter the network consecutively and have the same destination. The creation rate of flits is adjusted accordingly to reflect this
pattern: for example, with \gls{ida}-G2C3, the probability to create a pair would be set to $\frac{0.2}{6}$ to keep the base network injection rate at
0.2.

Some of the parameters were adopted from the simulation setup that \citeauthor{moriam18activeattackers} \cite{moriam18activeattackers} have employed
in their experiments to render results comparable with their evaluations. These parameters include the \gls{noc} dimensions, the base network
injection rate, and the simulation runtime. The rationale for a clock speed of 500 MHz was outlined in Section \ref{subsec:clockfrequency}.

In the experiments, a base network injection rate of 0.2 is assumed. This is the same value that \citeauthor{moriam18activeattackers} have chosen
\cite[2]{moriam18activeattackers} in order for the results to be comparable with their analyses. The actual injection rate may be higher as the base rate does not include the
issuance of \glspl{arq} and the resulting retransmissions.

\begin{table}
    \centering
    \begin{tabulary}{\textwidth}{C|C|C}
        Protocol & Ratio & Creation rate \\\hline
        \gls{ida}-UC & 1:2 & \\
    \end{tabulary}
    \caption[short]{long}
    \label{tab:creationrates}
\end{table}

\begin{itemize}
    \item Injection rate
        \begin{itemize}
            \item Value if 0.2 is realistic
            \item Possibility to generate pairs for fair comparison of UC/NC
            \item Base network injection rate of 0.2 is used for all experiments. The source flit creation rate is adjusted accordingly for the
                protocol variants to ensure that they have the same injection rate.
        \end{itemize}
    \item Overhead von Verschlüsselung+Auth vs. nur Auth vs keins von beiden (sowohl Latenz als auch Chipfläche)
\end{itemize}

The simulator has a variety of parameters that can be altered to influence its behavior and consequently the outcome of the simulations.


\begin{table}
    \centering
    \begin{tabulary}{\textwidth}{C|C|C}
        Parameter name & Value range & Placeholder \\\hline
        Network coding & $\{\mathit{UC}, \mathit{G2C3}, \mathit{G2C4}\}$ & \pNCMode{} \\
        No. of encryption modules & $\mathbb{N}^*$ & \pEncMods{} \\
        No. of authentication modules & $\mathbb{N}^*$ & \pAuthMods{} \\
        \Gls{arq} limit & $[1, 2]$ & \pARQLimit{} \\
        \Gls{arq} timeout & $\mathbb{N}^*$ cycles & \pARQTimeout{} \\
        Routing strategy & $\{\mathit{\gls{dor}}, \mathit{\gls{dm}}, \mathit{\gls{romm}}, \mathit{\gls{ramm}}\}$ & \pRStrat{} \\
    \end{tabulary}
    \caption[short]{long}
    \label{tab:inputparams}
\end{table}% TODO: finish table

\section{Attacker Model}\label{sec:attackermodeleval}
\begin{itemize}
    \item Focuses on malicious modifications rather than DoS attacks
    \item Assumption: compromised routers → rely on NIs for security
    \item No protection against bandwidth depletion, but this is not the goal here
    \item Variable number of compromised routers (e.g. 8 for an 8x8 grid)
    \item Compromised routers randomly drop or modify packets (no intelligent modifications/drops)
    \item Reasoning for having only some compromised routers (in regard to the 3rd party NoC problem → why would they not make all routers the same?)
        → HT implies more logic in routers → more area and draws more power → might attract attention if all routers have this and overall NoC
        parameters diverge considerably from the expectations
\end{itemize}

Compromised routers: 8 randomly selected routers (uniform distribution), 3 different sets, average over them

\begin{figure}
    \includegraphics[width=0.3\textwidth]{attacker-positions-1}\hfill
    \includegraphics[width=0.3\textwidth]{attacker-positions-2}\hfill
    \includegraphics[width=0.3\textwidth]{attacker-positions-3}
    \caption[Malicious router distributions]{The three distributions of 8 malicious routers over the 8x8 \gls{noc} that were used in experiments.}
    \label{fig:attackerpositions}
\end{figure}

\section{Determining The Hyperparameters}\label{sec:hyperparamseval}
\subsection{ARQ Timeouts}\label{subsec:arqtimeouts}
In Section \ref{subsec:arqretransmissions}, the concept of \glspl{arq} and timeouts was introduced: receivers issue \glspl{arq} when the temporal gap
between the arrival of flits belonging to the same transmission unit becomes too large, i.e. when a timeout occurs. Its value is determined through
experiments and measured in clock cycles.

\begin{figure}
    \centering
    \includegraphics[width=0.9\textwidth]{arq-timeouts-calc}
    \caption[Example of ARQ timeout calculation]{Example for the calculation of \gls{arq} timeouts. With a Manhattan distance of 4 between source $S$ and
    destination $D$ and a given inter-arrival timeout $t_1$, the \gls{arq} timeout $t_2(S, D)$ is computed as $t_1 + 2 \cdot 4 = t_1 + 8$ cycles.}
    \label{fig:arqtimeoutscalc}
\end{figure}

In addition to the inter-arrival timeout, there is another, higher value that is used after an \gls{arq} was issued to await the answer, as explained
in Section \ref{subsec:arqretransmissions}. The \gls{arq} answer timeout depends on the inter-arrival timeout and the Manhattan distance between the
two affected communication partners. More precisely, if $t_1$ is the inter-arrival timeout, $t_2(S, D)$ is the \gls{arq} answer timeout for a
particular source $S$ and destination $D$, and $d$ is the Manhattan distance between the two nodes, then $t_2(S, D) = t_1 + 2 \cdot d$. Figure
\vref{fig:arqtimeoutscalc} illustrates this calculation.

Hence, only $t_1$ needs to be determined through experiments. Since this is the first parameter to be fixed, the other input values for the simulation
are estimated. The tests are independent of the protocol variant as the same injection rate is used for all of them. Table \vref{tab:setuparqtimeouts}
presents how the simulator is set up.

\begin{table}
    \centering
    \begin{tabulary}{\textwidth}{C|C|C|C|C|C|C|C|C|C}
        \pProtVar{} & \pNCMode{} & \pEncMods{} & \pAuthMods{} & \pRQSize{} & \pARQLimit{} & \pARQTimeout{} & \pRStrat{} & \pNumAttackers{} & \pAttackProb{} \\\hline
        \gls{ida}   & varying    & 5           & 15           & unlimited  & 1            & varying        & \gls{dor}  & 0                & 0 \\
    \end{tabulary}
    \caption[Input parameters for ARQ timeouts experiment]{long}
    \label{tab:setuparqtimeouts}
\end{table}
% Why Ind. Auth.? Most flits per transmission unit (8 with G2C4)
% Why this number of enc./auth. units? Large number so there are definitely no internal congestions → area doesn't matter for this experiment
% Why ARQs per source flit and not per transmission unit? because size of trans. units varies considerably with prot. variant

To determine the timeout value, an uncompromised \gls{noc} (i.e., with zero malicious routers) is used. Ideally, no \glspl{arq} are issued in this
scenario. However, due to random deviations from the average flit injection rate, the network load varies over time and congestions in some routers
may occur. The resulting increased transmission delays may be high enough to trigger timeouts even when an \gls{arq} is not necessary. Sporadic
occurances of such cases cannot be ruled out, but should rarely happen. However, simply increasing the timeout until these cases vanish is undesirable
for two reasons. First, a high timeout directly corresponds to high latencies when flit losses necessitate \glspl{arq}. Second, the later an \gls{arq}
is issued, the larger the \gls{rtb} of the communication partner needs to be so that the flits in question are not already overwritten when the
\gls{arq} arrives. The goal of this experiment is to find a reasonable middle ground: the smallest timeout that does not entail a significant number of
unnecessary \glspl{arq} will be used for the subsequent evaluations.

\begin{figure}
    \centering
    \input{gnuplot/plots/arqtimeouts}
    \caption[Results for ARQ timeouts experiment]{long}
    \label{fig:resultsarqtimeouts}
\end{figure}

Figure \vref{fig:resultsarqtimeouts} shows the results for timeout values ranging from 3 to 15 cycles.

- Use sadias formula for RTB size estimation

We choose value of 12 because then for all NC variants, it is less than 1 ARQ per 100 source flits. Higher timeout would entail even less ARQs, but
increase latency and RTB sizes.

\subsection{Number Of Crypto Modules}
\begin{table}
    \centering
    \begin{tabulary}{\textwidth}{C|C|C|C|C|C|C|C|C|C}
        \pProtVar{} & \pNCMode{} & \pEncMods{} & \pAuthMods{} & \pRQSize{} & \pARQLimit{} & \pARQTimeout{} & \pRStrat{} & \pNumAttackers{} & \pAttackProb{} \\\hline
        varying     & varying    & varying     & varying      & unlimited  & 1            & 12             & \gls{dor}  & 8                & 0.2 \\
    \end{tabulary}
    \caption[Input parameters for number of crypto modules experiment]{long}
    \label{tab:setupnumcrypto}
\end{table}
- congestions in the queues in front of the crypto modules should be minimal
- less modules are better if possible because less chip area
- relatively high attack probabilities because more ARQs means more ver.+dec. retries at receivers, and network should be able to deal with that scenario
  "network needs to be equipped to deal with/handle periods of high traffic volumes"
- max. required enc. units: 4, because max. 2 flits can be drawn from the queues per cycle, so max. 4 flits active at the same time
- max. required auth. units: 12 (ind. auth), 10 (int. auth), 11 (gen. auth (2 flits = 11 cycles busy))
- criterion: max wait time needs to be 5 or less cycles

\begin{figure}
    \centering
    \begin{tabular}{ll}
        \input{gnuplot/plots/encmodules-ida} & \input{gnuplot/plots/authmodules-ida.tex} \\
        \input{gnuplot/plots/encmodules-iwa} & \input{gnuplot/plots/authmodules-iwa.tex} \\
        \input{gnuplot/plots/encmodules-fga} & \input{gnuplot/plots/authmodules-fga.tex}
    \end{tabular}
    \caption[Results for number of crypto modules experiment]{The number of encryption modules (left column) and authentication modules (right column)
    is shown in relation to the maximum and average wait times of enqueued flits. Each row represents one protocol variant.}
    \label{fig:resultscryptomodules}
\end{figure}

\subsection{Router Input Queue Sizes}
\begin{table}
    \centering
    \begin{tabulary}{\textwidth}{C|C|C|C|C|C|C|C|C|C}
        \pProtVar{} & \pNCMode{} & \pEncMods{} & \pAuthMods{} & \pRQSize{} & \pARQLimit{} & \pARQTimeout{} & \pRStrat{} & \pNumAttackers{} & \pAttackProb{} \\\hline
        \gls{ida} & varying & 3 & 9 & varying & 1 & 12 & \gls{dor} & 8 & 0.2 \\
    \end{tabulary}
    \caption[Input parameters for router queue sizes experiment]{long}
    \label{tab:setupqueuesizes}
\end{table}
- only node input queues; local input queues are left unlimited for simulation purposes to avoid any potential flit drops due to such a queue being full
- why IDA? largest transmission units (G2C4) and one of the smallest (UC)
- goal: as usual: as small as possible (→ less chip area) but not increase latencies too much
- explored as last hyperparameter because with static DOR it only shifts where flits wait to be routed, congestions do not affect route
  - will be crucial for the adaptive strategies though
- chosen value: 6 (increasing it does not substantially lower max/avg times and all avgs are below 1 or just very slightly above it)

\begin{figure}
    \centering
    \begin{tabular}{ll}
        \input{gnuplot/plots/queuelengths-ports} & \input{gnuplot/plots/queuelengths-local}
    \end{tabular}
    \caption[Results for router queue lengths experiment]{long}
    \label{fig:resultsqueuelengths}
\end{figure}

\section{Performance Comparisons}\label{sec:perfcompeval}
\subsection{Performances Of The Protocol Variants}
Record:
- acceptance rate (aka actual injection rate)
- information rate (source flits / total flits)
- residual error probability
- end-to-end latency

\begin{table}
    \centering
    \begin{tabulary}{\textwidth}{C|C|C|C|C|C|C|C|C|C}
        \pProtVar{} & \pNCMode{} & \pEncMods{} & \pAuthMods{} & \pRQSize{} & \pARQLimit{} & \pARQTimeout{} & \pRStrat{} & \pNumAttackers{} & \pAttackProb{} \\\hline
        varying & varying & 3 & 9 & 6 & 1 & 12 & \gls{dor} & 8 & varying \\
    \end{tabulary}
    \caption[Input parameters for protocol variant experiment]{long}
    \label{tab:setupprotvarexperiment}
\end{table}

\begin{figure}
    \centering
    \begin{tabular}{ll}
        \input{gnuplot/plots/main-acceptancerate} & \input{gnuplot/plots/main-informationrate} \\
        \input{gnuplot/plots/main-residualerror} & \input{gnuplot/plots/main-endtoendlatency}
    \end{tabular}
    \caption[Results for protocol variant experiment]{long}
    \label{fig:resultsprotvarexperiment}
\end{figure}

Observations:
- NC does not improve (=decrease) residual error. why? might be because you have 1 ARQ per generation (=0.5ARQs per source flit) for NC, but 1 ARQ per
source flit for UC (IDA protocol)
  - how to confirm? UC with ARQ limit 1 vs. NC with ARQ limit 2 (then same amount of ARQs per source flit)
  - ARQ flit itself is not coded → hence when it gets attacked, all retransmissions fail → for NC, on average a larger number of flits is affected by
    this → how to confirm? set routers to not attack ARQ flits
  - may be exciting to see if this is the case as well for IWA because there you have 1 ARQ per source flit for both UC and NC

\subsection{Performances Of The Routing Strategies}
Take: best protocol variant (IWA), use it to find the best routing strategy

\begin{table}
    \centering
    \begin{tabulary}{\textwidth}{C|C|C|C|C|C|C|C|C|C}
        \pProtVar{} & \pNCMode{} & \pEncMods{} & \pAuthMods{} & \pRQSize{} & \pARQLimit{} & \pARQTimeout{} & \pRStrat{} & \pNumAttackers{} & \pAttackProb{} \\\hline
        \gls{iwa} & varying & 3 & 9 & 6 & 1 & 12 & varying & 8 & varying \\
    \end{tabulary}
    \caption[Input parameters for main experiment]{long}
    \label{tab:setuproutingstratexperiment}
\end{table}


% Heatmap of router workload?
\begin{figure}
    \input{gnuplot/plots/heatmap-dor}
    \caption[short]{Heatmaps}
    \label{fig:resultsroutingstratheatmaps}
\end{figure}

\iffalse
Experiment setup parameter tables:
- NC mode (UC, G2C3, G2C4)
- ...

ARQ Limit: 1, at most 2 because more ARQs allowed per transmission unit means larger retransmission buffers everywhere

Do one experiment with the 8 routers with attack probability one and compare the routing strategies

"Results for IWA-NC confirm the alleged positive effect of NC in unreliable networks"

"Creation rate adjustment to keep the base injection rate constant is reflected in the differing information rates"

"IDA: 4 flits need to arrive unharmed for successful transmission unit, 3 for FGA, and 2 for IWA"

"NC proves to provide a performance improvement, although more in the sense of less residual errors than a decrease in latency since ARQs are still
limited to 1 per transmission unit across all variants."

\section{Statistics}
\begin{itemize}
    \item Injection/acceptance rate: [0, 1] (at processing element and at network interface)
    \item Queue lengths and buffer sizes
    \item Workload of crypto units
    \item Average/max flit waiting time at entry guard
    \item Average/max hop count
\end{itemize}

\section{Area Overhead}
\fi
